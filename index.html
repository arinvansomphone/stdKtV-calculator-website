<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>stdKt/V Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="Arin Vansomphone" />

  <!-- styles & fonts -->
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible+Next:wght@200..800&family=Inter:wght@100..900&display=swap" rel="stylesheet" />

  <!-- Chart.js first -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>

  <!-- Your ES-modules (graph first, then controller) -->
  <script type="module" src="graph.js" defer></script>
  <script type="module" src="controller.js" defer></script>
</head>

<body>
<header>
  <div class="title"><a href="index.html">stdKt/V CALCULATOR</a></div>
  <nav><a href="about.html">About</a></nav>
</header>

<section class="hero">
  <h1>stdKt/V Calculator</h1>
  <p class="grey">Calculate the appropriate time required to achieve stdKt/V.</p>
</section>

<div class="box-container">
  <!-- ========= PARAMETERS + SUBMIT ======================================= -->
  <form id="dialysisForm" class="box parameters-box">
    <h2>Parameters for Current 3x per Week Dialysis</h2>

    <div class="input-question">
      <b>Do you have an estimate of the urea distribution volume?</b><br>
      <div class="radio-group">
        <label><input type="radio" name="isestimate" value="yes"> Yes</label>
        <label><input type="radio" name="isestimate" value="no" checked> No</label>
      </div>
    </div>

    <!-- urea Vd : manual or auto-calculated -->
    <div id="volume-input" style="display:none">
      <div class="input-question">
        <label for="ureaDistribution">Urea volume of distribution:</label><br>
        <div><input type="number" id="ureaDistribution" class="numeric-input" step="any"><span> L</span></div>
      </div>
    </div>

    <div id="volume-display">
      <div class="input-question">
        <label>Urea volume of distribution:</label><br>
        <div><input readonly id="ureaDisplay" class="numeric-input"><span> L</span></div>
      </div>
    </div>

    <div id="gender-height-age">
      <div class="input-question">
        <label>Gender at birth:</label><br>
        <div class="radio-group">
          <label><input type="radio" name="gender" value="male" checked> Male</label>
          <label><input type="radio" name="gender" value="female"> Female</label>
        </div>
      </div>

      <div class="input-question">
        <label for="height">Height:</label><br>
        <div><input type="number" id="height" class="numeric-input" value="180" required><span> cm</span></div>
      </div>

      <div class="input-question">
        <label for="age">Age:</label><br>
        <div><input type="number" id="age" class="numeric-input" value="65" required><span> yrs</span></div>
      </div>
    </div>

    <!-- remaining numeric inputs -->
    <div class="input-question"><label>End treatment weight:</label><br><div><input type="number" id="weight" class="numeric-input" value="70" required><span> kg</span></div></div>
    <div class="input-question"><label>Dialysis time:</label><br><div><input type="number" id="time" class="numeric-input" value="300" required><span> min</span></div></div>
    <div class="input-question"><label>Weekly UF:</label><br><div><input type="number" id="weeklyuf" class="numeric-input" value="7" required><span> L/wk</span></div></div>
    <div class="input-question"><label>Kru, default is 0:</label><br><div><input type="number" id="kru" class="numeric-input" value="0" step="any" required><span> mL/min</span></div></div>
    <div class="input-question"><label>Current spKt/V:</label><br><div><input type="number" id="spKtV_current" class="numeric-input" value="1.3" step="any" min="0" required></div></div>
    <div class="input-question"><label>Target stdKt/V, default is 2.3:</label><br><div><input type="number" id="stdKtV_target" class="numeric-input" value="2.3" step="any" min="0" required></div></div>
    <div class="input-question">
      <label>Pre-treatment PUN when spKt/V was obtained:</label><br>
      <div style="display: flex; align-items: center; gap: 0.5rem;">
        <div class="radio-group">
          <label><input type="radio" name="pun-unit" value="M" checked> M</label>
          <label><input type="radio" name="pun-unit" value="W"> W</label>
          <label><input type="radio" name="pun-unit" value="F"> F</label>
        </div>
        <input type="number" id="G" class="numeric-input" value="100" step="any" min="0" required><span> mg/dL</span>
      </div>
    </div>

    <!-- SUBMIT -->
    <button id="calculate" type="submit">Calculate&nbsp;&amp;&nbsp;Plot</button>
  </form>

  <!-- ========= RESULTS / CHART =========================================== -->
  <div class="box output-box">
    <h2 class="results-title">Results</h2><br>

    <div class="graph"><canvas id="myLineChart"></canvas></div>

    <div class="custom-legend-container">
      <div id="legendSubtitle" style="text-align:center;font-weight:bold;margin-bottom:0.5rem;">Click legend to make option appear/disappear</div>
      <div id="chartLegend"></div>
    </div>

    <div class="output-column">
      <h3>New 3x per Week Dialysis:</h3>
      <p><b>Time required:</b> <span id="timeOutputThrice"></span></p>
      <p><b>Ultrafiltration rate:</b> <span id="UF_RateThrice"></span></p>
      <p><b>New spKt/V:</b> <span id="newspKtVThrice"></span></p>
      <p id="UF_WarningThrice"></p>
    </div>

    <div class="output-column">
      <h3>2x per Week Dialysis:</h3>
      <p><b>Time required:</b> <span id="timeOutputTwice"></span></p>
      <p><b>Ultrafiltration rate:</b> <span id="UF_RateTwice"></span></p>
      <p><b>New spKt/V:</b> <span id="newspKtVTwice"></span></p>
      <p id="UF_WarningTwice"></p>
    </div>

  </div>
</div>

<footer><p>Version 1.0</p></footer>
</body>
</html>
